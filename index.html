<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: var(--tg-theme-bg-color, #ffffff);
            --text: var(--tg-theme-text-color, #000000);
            --accent: var(--tg-theme-button-color, #007aff);
            --secondary: var(--tg-theme-secondary-bg-color, #f2f2f7);
            --gray: #8e8e93;
        }

        body { 
            font-family: -apple-system, sans-serif; 
            background: var(--bg); 
            color: var(--text); 
            margin: 0; 
            padding-bottom: 80px;
            overflow-x: hidden;
        }

        .header { padding: 20px 15px; font-size: 26px; font-weight: 800; }
        .page { display: none; padding: 0 15px; }
        .page.active { display: block; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .card { background: var(--secondary); border-radius: 18px; overflow: hidden; border: 0.5px solid rgba(0,0,0,0.1); cursor: pointer; }
        .card img { width: 100%; height: 180px; object-fit: cover; }
        .card-label { padding: 10px; font-weight: 600; font-size: 14px; text-align: center; }

        #viewer { 
            display: none; 
            position: fixed; 
            top: 0; left: 0; 
            width: 100vw; height: 100vh; 
            background: var(--bg); 
            z-index: 1000; 
        }
        .viewer-header { 
            position: absolute; top: 0; width: 100%; 
            padding: 15px; display: flex; box-sizing: border-box;
            justify-content: space-between; align-items: center;
            z-index: 1001; background: var(--bg);
            border-bottom: 0.5px solid rgba(0,0,0,0.1);
        }
        .close-btn { background: var(--accent); color: #fff; border: none; padding: 6px 12px; border-radius: 8px; font-weight: 600; }

        .slider-container { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .slide-img { max-width: 95%; max-height: 80vh; transition: transform 0.1s ease-out; box-shadow: 0 5px 15px rgba(0,0,0,0.1); touch-action: none;}

        .row-item { background: var(--secondary); padding: 15px; border-radius: 15px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .row-info strong { display: block; font-size: 16px; }
        .row-info span { font-size: 12px; color: var(--gray); }

        .nav { position: fixed; bottom: 0; width: 100%; height: 70px; background: var(--bg); display: flex; border-top: 0.5px solid rgba(0,0,0,0.1); z-index: 999; }
        .nav-btn { flex: 1; border: none; background: none; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; color: var(--gray); cursor: pointer; }
        .nav-btn.active { color: var(--accent); }
        .nav-icon { font-size: 22px; margin-bottom: 4px; }
    </style>
</head>
<body>

    <div id="answers" class="page active">
        <div class="header">–û—Ç–≤–µ—Ç—ã</div>
        <div class="grid">
            <div class="card" onclick="startBook(1, 26)"><img src="img/t1.png"><div class="card-label">Les Grands Classiques tome 11</div></div>
            <div class="card" onclick="startBook(2, 26)"><img src="img/t2.png"><div class="card-label">Les Grands Classiques tome 3</div></div>
            <div class="card" onclick="startBook(3, 26)"><img src="img/t3.png"><div class="card-label">Vitraux tome 2</div></div>
            <div class="card" onclick="startBook(4, 26)"><img src="img/t4.png"><div class="card-label">Trompe L'oeil Babies</div></div>
            <div class="card" onclick="startBook(5, 11)"><img src="img/t5.png"><div class="card-label">Trompe L'oeil Grand Bloc</div></div>
            <div class="card" onclick="startBook(6, 10)"><img src="img/t6.png"><div class="card-label">Stitch Au numero</div></div>
            <div class="card" onclick="startBook(7, 26)"><img src="img/t7.png"><div class="card-label">Sous L'Ocean</div></div>
            <div class="card" onclick="startBook(8, 26)"><img src="img/t8.png"><div class="card-label">Saisons</div></div>
            <div class="card" onclick="startBook(9, 10)"><img src="img/t9.png"><div class="card-label">Romantasy</div></div>
            <div class="card" onclick="startBook(10, 26)"><img src="img/t10.png"><div class="card-label">Princesses tome 1</div></div>
            <div class="card" onclick="startBook(11, 26)"><img src="img/t11.png"><div class="card-label">Princesses tome 2</div></div>
            <div class="card" onclick="startBook(12, 26)"><img src="img/t12.png"><div class="card-label">Princes&Heros</div></div>
            <div class="card" onclick="startBook(13, 26)"><img src="img/t13.png"><div class="card-label">Portraits De Famille</div></div>
            <div class="card" onclick="startBook(14, 26)"><img src="img/t14.png"><div class="card-label">Pokemon</div></div>
            <div class="card" onclick="startBook(15, 26)"><img src="img/t15.png"><div class="card-label">Pixar</div></div>
            <div class="card" onclick="startBook(16, 26)"><img src="img/t16.png"><div class="card-label">Petites Princesses</div></div>
            <div class="card" onclick="startBook(17, 26)"><img src="img/t17.png"><div class="card-label">Petites Betes</div></div>
            <div class="card" onclick="startBook(18, 26)"><img src="img/t18.png"><div class="card-label">Mondes Fantastiques</div></div>
            <div class="card" onclick="startBook(19, 26)"><img src="img/t19.png"><div class="card-label">Mickey, Donald&Co</div></div>
            <div class="card" onclick="startBook(20, 26)"><img src="img/t20.png"><div class="card-label">Mechants</div></div>
            <div class="card" onclick="startBook(21, 26)"><img src="img/t21.png"><div class="card-label">Marsupilami</div></div>
            <div class="card" onclick="startBook(22, 26)"><img src="img/t22.png"><div class="card-label">Love Stories</div></div>
            <div class="card" onclick="startBook(23, 26)"><img src="img/t23.png"><div class="card-label">Looney Tunes tome 3s</div></div>
            <div class="card" onclick="startBook(24, 26)"><img src="img/t24.png"><div class="card-label">Lilo Et Stitch</div></div>
            <div class="card" onclick="startBook(25, 26)"><img src="img/t25.png"><div class="card-label">Debutants tome 1</div></div>
            <div class="card" onclick="startBook(26, 26)"><img src="img/t26.png"><div class="card-label">Debutants tome 2</div></div>
            <div class="card" onclick="startBook(27, 26)"><img src="img/t27.png"><div class="card-label">Au numero</div></div>
            <div class="card" onclick="startBook(28, 9)"><img src="img/t28.png"><div class="card-label">La Petite Sirene</div></div>
            <div class="card" onclick="startBook(29, 26)"><img src="img/t29.png"><div class="card-label">Les Schtroumpfs 1</div></div>
            <div class="card" onclick="startBook(30, 26)"><img src="img/t30.png"><div class="card-label">Les Schtroumpfs 2</div></div>
            <div class="card" onclick="startBook(31, 26)"><img src="img/t31.png"><div class="card-label">L'age Glace</div></div>
            <div class="card" onclick="startBook(32, 26)"><img src="img/t32.png"><div class="card-label">Hiver</div></div>
            <div class="card" onclick="startBook(33, 26)"><img src="img/t33.png"><div class="card-label">Heros&Mechants</div></div>
            <div class="card" onclick="startBook(34, 10)"><img src="img/t34.png"><div class="card-label">Grand Bloc</div></div>
            <div class="card" onclick="startBook(35, 26)"><img src="img/t35.png"><div class="card-label">Coliector</div></div>
            <div class="card" onclick="startBook(36, 26)"><img src="img/t36.png"><div class="card-label">Girl Power</div></div>
            <div class="card" onclick="startBook(37, 26)"><img src="img/t37.png"><div class="card-label">Fees&Sorciers</div></div>
            <div class="card" onclick="startBook(38, 26)"><img src="img/t38.png"><div class="card-label">Famille</div></div>
            <div class="card" onclick="startBook(39, 10)"><img src="img/t39.png"><div class="card-label">Douce France</div></div>
            <div class="card" onclick="startBook(40, 26)"><img src="img/t40.png"><div class="card-label">Chiots&Chiens</div></div>
            <div class="card" onclick="startBook(41, 14)"><img src="img/t41.png"><div class="card-label">Chevaux</div></div>
            <div class="card" onclick="startBook(42, 9)"><img src="img/t42.png"><div class="card-label">Bisounours</div></div>
            <div class="card" onclick="startBook(43, 26)"><img src="img/t43.png"><div class="card-label">Best Of Pixar</div></div>
            <div class="card" onclick="startBook(44, 26)"><img src="img/t44.png"><div class="card-label">Best Of Grands Classiques</div></div>
            <div class="card" onclick="startBook(45, 26)"><img src="img/t45.png"><div class="card-label">La Belle Et La Bete</div></div>
            <div class="card" onclick="startBook(46, 26)"><img src="img/t46.png"><div class="card-label">Bestiaire</div></div>
            <div class="card" onclick="startBook(47, 26)"><img src="img/t47.png"><div class="card-label">Best Of Heroines</div></div>
        </div>
    </div>

<div id="palettes" class="page">
        <div class="header">–ü–∞–ª–∏—Ç—Ä—ã</div>
        
        <div class="cat-title">GuangNa</div>
        <div class="row-item"><div class="row-info"><strong>GuangNa 120</strong><span>–ü–∞–ª–∏—Ç—Ä–∞ —Ü–≤–µ—Ç–æ–≤</span></div><button class="close-btn" onclick="openPdf('https://hachettelittleheroes.github.io/HachetteLittleHeroesBot/palitri/guangna120.pdf')">–û—Ç–∫—Ä—ã—Ç—å</button></div>
        <div class="row-item"><div class="row-info"><strong>GuangNa 168</strong><span>–ü–∞–ª–∏—Ç—Ä–∞ —Ü–≤–µ—Ç–æ–≤</span></div><button class="close-btn" onclick="openPdf('https://hachettelittleheroes.github.io/HachetteLittleHeroesBot/palitri/guangna168.pdf')">–û—Ç–∫—Ä—ã—Ç—å</button></div>
        <div class="row-item"><div class="row-info"><strong>GuangNa 240</strong><span>–ü–∞–ª–∏—Ç—Ä–∞ —Ü–≤–µ—Ç–æ–≤</span></div><button class="close-btn" onclick="openPdf('https://hachettelittleheroes.github.io/HachetteLittleHeroesBot/palitri/guangna240.pdf')">–û—Ç–∫—Ä—ã—Ç—å</button></div>
        <div class="row-item"><div class="row-info"><strong>GuangNa 288</strong><span>–ü–∞–ª–∏—Ç—Ä–∞ —Ü–≤–µ—Ç–æ–≤</span></div><button class="close-btn" onclick="openPdf('https://hachettelittleheroes.github.io/HachetteLittleHeroesBot/palitri/guangna288.pdf')">–û—Ç–∫—Ä—ã—Ç—å</button></div>
        <div class="row-item"><div class="row-info"><strong>GuangNa 360</strong><span>–ü–∞–ª–∏—Ç—Ä–∞ —Ü–≤–µ—Ç–æ–≤</span></div><button class="close-btn" onclick="openPdf('https://hachettelittleheroes.github.io/HachetteLittleHeroesBot/palitri/guangna360.pdf')">–û—Ç–∫—Ä—ã—Ç—å</button></div>
        
        <div class="cat-title">–î—Ä—É–≥–∏–µ –±—Ä–µ–Ω–¥—ã</div>
        <div class="row-item"><div class="row-info"><strong>Grasp 168</strong><span>–ü–∞–ª–∏—Ç—Ä–∞ —Ü–≤–µ—Ç–æ–≤</span></div><button class="close-btn" onclick="openPdf('https://hachettelittleheroes.github.io/HachetteLittleHeroesBot/palitri/grasp168.pdf')">–û—Ç–∫—Ä—ã—Ç—å</button></div>
        <div class="row-item"><div class="row-info"><strong>Tooli-Art</strong><span>–ü–∞–ª–∏—Ç—Ä–∞ —Ü–≤–µ—Ç–æ–≤</span></div><button class="close-btn" onclick="openPdf('https://hachettelittleheroes.github.io/HachetteLittleHeroesBot/palitri/tooli-art.pdf')">–û—Ç–∫—Ä—ã—Ç—å</button></div>
        <div class="row-item"><div class="row-info"><strong>Zibeef 240</strong><span>–ü–∞–ª–∏—Ç—Ä–∞ —Ü–≤–µ—Ç–æ–≤</span></div><button class="close-btn" onclick="openPdf('https://hachettelittleheroes.github.io/HachetteLittleHeroesBot/palitri/zibeef240.pdf')">–û—Ç–∫—Ä—ã—Ç—å</button></div>
    </div>
    <div id="shop" class="page">
        <div class="header">–ù–∞–ª–∏—á–∏–µ</div>
        <div class="row-item">
            <div class="row-info"><strong>–ú–∞—Ä–∫–µ—Ä—ã Arrtx 80</strong><span style="color: #34c759;">–í –Ω–∞–ª–∏—á–∏–∏: 5 —à—Ç.</span></div>
            <button class="close-btn" onclick="sendOrder('Arrtx 80')">–ö—É–ø–∏—Ç—å</button>
        </div>
    </div>

    <div id="viewer">
        <div class="viewer-header">
            <button class="close-btn" onclick="closeBook()">–ù–∞–∑–∞–¥</button>
            <div id="page-counter" style="font-weight: bold;">1 / 1</div>
        </div>
        <div class="slider-container" id="slider" ontouchstart="handleTouchStart(event)" ontouchmove="handleTouchMove(event)" ontouchend="handleTouchEnd(event)">
            <img src="" id="current-page" class="slide-img">
        </div>
    </div>

    <nav class="nav">
        <button id="btn-answers" class="nav-btn active" onclick="tab('answers')"><span class="nav-icon">üìö</span>–û—Ç–≤–µ—Ç—ã</button>
        <button id="btn-palettes" class="nav-btn" onclick="tab('palettes')"><span class="nav-icon">üé®</span>–ü–∞–ª–∏—Ç—Ä—ã</button>
        <button id="btn-shop" class="nav-btn" onclick="tab('shop')"><span class="nav-icon">üõí</span>–ù–∞–ª–∏—á–∏–µ</button>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        let currentVol = 1;
        let currentPage = 1;
        let maxPages = 1;
        let touchStartX = 0;
        let zoomScale = 1;
        let lastDist = 0;

        function tab(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.getElementById('btn-' + id).classList.add('active');
            tg.HapticFeedback.selectionChanged();
        }

        function startBook(volId, count) {
            currentVol = volId;
            maxPages = count;
            currentPage = 1;
            document.getElementById('viewer').style.display = 'block';
            updatePage();
            tg.HapticFeedback.impactOccurred('medium');
        }

        function closeBook() {
            document.getElementById('viewer').style.display = 'none';
            zoomScale = 1;
            document.getElementById('current-page').style.transform = `scale(1)`;
        }
function openPdf(url) {
            // –ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–∫—Ä—ã—Ç—å –≤–Ω—É—Ç—Ä–∏, –Ω–æ –µ—Å–ª–∏ —Å–∏—Å—Ç–µ–º–∞ —Ä–µ—à–∏—Ç –∏–Ω–∞—á–µ - –æ—Ç–∫—Ä–æ–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ
            tg.openLink(url, {try_instant_view: true});
        }
        function updatePage() {
            const img = document.getElementById('current-page');
            const counter = document.getElementById('page-counter');
            zoomScale = 1;
            img.style.transform = `scale(1)`;
            
            const basePath = `otveti/t${currentVol}/${currentPage}`;
            const formats = ['.jpg', '.jpeg', '.png', '.JPG', '.PNG', '.JPEG'];
            let fIndex = 0;

            img.onerror = function() {
                fIndex++;
                if (fIndex < formats.length) {
                    this.src = basePath + formats[fIndex] + '?v=' + Math.floor(Math.random() * 1000);
                } else {
                    console.error("Not found");
                    this.onerror = null;
                }
            };

            img.src = basePath + formats[0] + '?v=' + Math.floor(Math.random() * 1000);
            counter.innerText = `${currentPage} / ${maxPages}`;
            
            // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ —Å–ª–µ–¥—É—é—â–µ–π (—Ç–∏—Ö–æ –≤ —Ñ–æ–Ω–µ)
            if (currentPage < maxPages) {
                new Image().src = `otveti/t${currentVol}/${currentPage + 1}.jpg`;
            }
        }

        let touchEndX = 0;

        function handleTouchStart(e) {
            // –ï—Å–ª–∏ —É–≤–µ–ª–∏—á–∏–ª–∏ –∫–∞—Ä—Ç–∏–Ω–∫—É, —Å–≤–∞–π–ø –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –¥–≤–∏–≥–∞—Ç—å —Ñ–æ—Ç–æ
            if (zoomScale > 1) return;
            
            if (e.touches.length === 1) {
                touchStartX = e.touches[0].screenX;
            }
            if (e.touches.length === 2) {
                lastDist = Math.hypot(e.touches[0].pageX - e.touches[1].pageX, e.touches[0].pageY - e.touches[1].pageY);
            }
        }

        function handleTouchMove(e) {
            // –ó—É–º –¥–≤—É–º—è –ø–∞–ª—å—Ü–∞–º–∏
            if (e.touches.length === 2) {
                const dist = Math.hypot(e.touches[0].pageX - e.touches[1].pageX, e.touches[0].pageY - e.touches[1].pageY);
                zoomScale = Math.min(Math.max(1, zoomScale * (dist / lastDist)), 4);
                document.getElementById('current-page').style.transform = `scale(${zoomScale})`;
                lastDist = dist;
                if (e.cancelable) e.preventDefault(); // –ó–∞–ø—Ä–µ—â–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É –ø—Ä–∏ –∑—É–º–µ
            }
            
            // –ï—Å–ª–∏ –ª–∏—Å—Ç–∞–µ–º (–æ–¥–∏–Ω –ø–∞–ª–µ—Ü) –∏ –∫–∞—Ä—Ç–∏–Ω–∫–∞ –Ω–µ —É–≤–µ–ª–∏—á–µ–Ω–∞
            if (e.touches.length === 1 && zoomScale === 1) {
                touchEndX = e.touches[0].screenX;
                // –ï—Å–ª–∏ –¥–≤–∏–∂–µ–Ω–∏–µ —è–≤–Ω–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ ‚Äî –±–ª–æ–∫–∏—Ä—É–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª
                if (Math.abs(touchStartX - touchEndX) > 10) {
                    if (e.cancelable) e.preventDefault();
                }
            }
        }

        function handleTouchEnd(e) {
            if (zoomScale > 1) return;
            
            let diff = touchStartX - e.changedTouches[0].screenX;
            
            // –£–º–µ–Ω—å—à–∏–ª–∏ –ø–æ—Ä–æ–≥ –¥–æ 40 –¥–ª—è –ª–µ–≥–∫–æ—Å—Ç–∏
            if (Math.abs(diff) > 40) {
                if (diff > 0 && currentPage < maxPages) {
                    currentPage++;
                    updatePage();
                    tg.HapticFeedback.impactOccurred('light'); // –õ–µ–≥–∫–∞—è –≤–∏–±—Ä–∞—Ü–∏—è –ø—Ä–∏ –ø–µ—Ä–µ–ª–∏—Å—Ç—ã–≤–∞–Ω–∏–∏
                } else if (diff < 0 && currentPage > 1) {
                    currentPage--;
                    updatePage();
                    tg.HapticFeedback.impactOccurred('light');
                }
            }
        }
        function sendOrder(item) {
            tg.showConfirm(`–í—ã —Ö–æ—Ç–∏—Ç–µ –∑–∞–∫–∞–∑–∞—Ç—å ${item}?`, (ok) => {
                if (ok) tg.sendData(JSON.stringify({action: "order", item: item}));
            });
        }
    </script>
</body>
</html>
